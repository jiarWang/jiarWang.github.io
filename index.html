<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Joetube">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Joetube">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Joetube">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Joetube</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Joetube</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">业精于勤荒于嬉</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/30/MotionEvent事件分发机制解读/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Joe Wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/joe.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Joetube">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/30/MotionEvent事件分发机制解读/" itemprop="url">MotionEvent事件分发机制解读</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-30T22:01:52+08:00">
                2018-01-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="阅读提示"><a href="#阅读提示" class="headerlink" title="阅读提示"></a>阅读提示</h1><p></p><p class="text_indent_2"><b>开篇强调，<code>事件</code>与<code>手势动作</code>(点击、滑动等)是有区别，例如：一个滑动事件以ACTION_DOWN事件开始，经历多个ACTION_MOVE事件，最后以ACTION_UP事件结束。而<code>分发机制</code>讲述的主体是<code>事件</code>，没这点的意识的话，理解起来估计就没完没了。还有要理解<code>super</code>关键字并不是父<code>ViewGroup</code>（大多时候<code>ViewGroup</code>中的<code>super</code>很有可能指的就是<code>View</code>这个java类）。</b></p>
<h1 id="关键函数"><a href="#关键函数" class="headerlink" title="关键函数"></a>关键函数</h1><p></p><p class="text_indent_2">说到点击事件的分发怎么能不提到这三个函数：</p>
<p></p><p class="text_indent_4">public boolean dispatchTouchEvent(MotionEvent ev)</p>
<p></p><p class="text_indent_4">public boolean onInterceptTouchEvent(MotionEvent ev)</p>
<p></p><p class="text_indent_4">public boolean onTouchEvent(MotionEvent ev)</p>
<h1 id="主体内容"><a href="#主体内容" class="headerlink" title="主体内容"></a>主体内容</h1><h2 id="dispatchTouchEvent来源"><a href="#dispatchTouchEvent来源" class="headerlink" title="dispatchTouchEvent来源"></a><code>dispatchTouchEvent</code>来源</h2><p></p><p class="text_indent_2">其中最难理解的也就是<code>dispatchTouchEvent</code>了，而且<code>dispachTouchEvent</code>描述了整个事件的分发与处理流程。</p>
<p></p><p class="text_indent_2">当点击屏幕时，事件最先传递给<code>Activity</code>的<code>dispatchTouchEvent(MotionEvent ev)</code>,下面我们开始分析源码：</p>
<p></p><p class="text_indent_2">源码：Activity#dispatchTouchEvent</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Called to process touch screen events.  You can override this to</span></span><br><span class="line"><span class="comment"> * intercept all touch screen events before they are dispatched to the</span></span><br><span class="line"><span class="comment"> * window.  Be sure to call this implementation for touch screen events</span></span><br><span class="line"><span class="comment"> * that should be handled normally.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ev The touch screen event.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> boolean Return true if this event was consumed.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ev.getAction() == MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">        onUserInteraction();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (getWindow().superDispatchTouchEvent(ev)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> onTouchEvent(ev);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Called whenever a key, touch, or trackball event is dispatched to the</span></span><br><span class="line"><span class="comment"> * activity.  Implement this method if you wish to know that the user has</span></span><br><span class="line"><span class="comment"> * interacted with the device in some way while your activity is running.</span></span><br><span class="line"><span class="comment"> * This callback and &#123;<span class="doctag">@link</span> #onUserLeaveHint&#125; are intended to help</span></span><br><span class="line"><span class="comment"> * activities manage status bar notifications intelligently; specifically,</span></span><br><span class="line"><span class="comment"> * for helping activities determine the proper time to cancel a notfication.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;All calls to your activity's &#123;<span class="doctag">@link</span> #onUserLeaveHint&#125; callback will</span></span><br><span class="line"><span class="comment"> * be accompanied by calls to &#123;<span class="doctag">@link</span> #onUserInteraction&#125;.  This</span></span><br><span class="line"><span class="comment"> * ensures that your activity will be told of relevant user activity such</span></span><br><span class="line"><span class="comment"> * as pulling down the notification pane and touching an item there.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Note that this callback will be invoked for the touch down action</span></span><br><span class="line"><span class="comment"> * that begins a touch gesture, but may not be invoked for the touch-moved</span></span><br><span class="line"><span class="comment"> * and touch-up actions that follow.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #onUserLeaveHint()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onUserInteraction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p></p><p class="text_indent_2">显然，从内容上看<code>onUserInteraction();</code>并不影响事件的传递，它只是可以在一个新手势开始(<code>ACTION_DOWN</code>事件发生)时，在事件传递开始前做最优先的事情。</p>
<p></p><p class="text_indent_2">下面会执行<code>getWindow().superDispatchTouchEvent(ev)</code>操作，那么<code>getWindow()</code>又是啥？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">......</span><br><span class="line">mWindow = <span class="keyword">new</span> PhoneWindow(<span class="keyword">this</span>, window, activityConfigCallback);</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Retrieve the current &#123;<span class="doctag">@link</span> android.view.Window&#125; for the activity.</span></span><br><span class="line"><span class="comment"> * This can be used to directly access parts of the Window API that</span></span><br><span class="line"><span class="comment"> * are not available through Activity/Screen.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> Window The current window, or null if the activity is not</span></span><br><span class="line"><span class="comment"> *         visual.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Window <span class="title">getWindow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mWindow;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再进入<a href="http://androidxref.com" target="_blank" rel="noopener">AndroidXRef</a>，找到<code>PhoneWindow.java</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This is the top-level view of the window, containing the window decor.</span></span><br><span class="line"><span class="keyword">private</span> DecorView mDecor;</span><br><span class="line">....</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">superDispatchTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mDecor.superDispatchTouchEvent(event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>咋样？是不是想到了传说种的<code>Activity-&gt;PhoneWindow-&gt;DecorView</code>。且慢，我们的目的时“事件分发机制”。那么重新找到<code>DecorView.java</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">superDispatchTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.dispatchTouchEvent(event);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p></p><p class="text_indent_2">而<code>DecorView extends FrameLayout</code>，现在知道为啥有的文章说“所有的布局都在一个<code>FrameLayout</code>里面”了吧？其实就是<code>DecorView</code>,<code>FrameLayout extends ViewGroup</code>，简单梳理就会知道这个<code>dispatchTouchEvent(event)</code>就是在<code>ViewGroup</code>种实现的。</p>
<p></p><p class="text_indent_2">最终还是看<code>ViewGroup</code>怎么实现这个<code>dispatchTouchEvent(event)</code>；<code>ViewGroup#dispatchTouchEvent(MotionEvent ev)</code>,<b>最终</b>返回<code>true</code>的话，<code>Activity#dispatchTouchEvent(MotionEvent ev)</code>函数就直接返回了,<code>Activity#onTouchEvent(ev)</code>也不会被调用，如果<b>最终</b>返回为<code>false</code>的话则<code>Activity#onTouchEvent(ev)</code>执行，为什么要加“最终”二字。请听我娓娓道来，前方高能。</p>
<h2 id="源码解析"><a href="#源码解析" class="headerlink" title="源码解析"></a>源码解析</h2><h3 id="dispatchTouchEvent源码"><a href="#dispatchTouchEvent源码" class="headerlink" title="dispatchTouchEvent源码"></a><code>dispatchTouchEvent</code>源码</h3><p></p><p class="text_indent_2">没错，源码（为了便于理解，这段源码有一点点的删除，阅读的时候可直接跳过这一段源码，因为我会在后面具体分析）：ViewGroup#dispatchTouchEvent(MotionEvent ev):</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ev.isFromSource(InputDevice.SOURCE_MOUSE)</span><br><span class="line">            &amp;&amp; ev.getAction() == MotionEvent.ACTION_DOWN</span><br><span class="line">            &amp;&amp; ev.isButtonPressed(MotionEvent.BUTTON_PRIMARY)</span><br><span class="line">            &amp;&amp; isOnScrollbarThumb(ev.getX(), ev.getY())) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">.....</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//第一段-----------------------------------------------------------START</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> action = ev.getAction();</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> actionMasked = action &amp; MotionEvent.ACTION_MASK;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Handle an initial down.</span></span><br><span class="line">        <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">            <span class="comment">// Throw away all previous state when starting a new touch gesture.</span></span><br><span class="line">            <span class="comment">// The framework may have dropped the up or cancel event for the previous gesture</span></span><br><span class="line">            <span class="comment">// due to an app switch, ANR, or some other state change.</span></span><br><span class="line">            cancelAndClearTouchTargets(ev);</span><br><span class="line">            resetTouchState();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Check for interception.</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> intercepted;</span><br><span class="line">        <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN</span><br><span class="line">                || mFirstTouchTarget != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">boolean</span> disallowIntercept = (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) != <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (!disallowIntercept) &#123;</span><br><span class="line">                intercepted = onInterceptTouchEvent(ev);</span><br><span class="line">                ev.setAction(action); <span class="comment">// restore action in case it was changed</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                intercepted = <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// There are no touch targets and this action is not an initial down</span></span><br><span class="line">            <span class="comment">// so this view group continues to intercept touches.</span></span><br><span class="line">            intercepted = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//第一段-----------------------------------------------------------END</span></span><br><span class="line">        <span class="comment">//第二段-----------------------------------------------------------START</span></span><br><span class="line">        <span class="keyword">if</span> (!canceled &amp;&amp; !intercepted) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// If the event is targeting accessiiblity focus we give it to the</span></span><br><span class="line">            <span class="comment">// view that has accessibility focus and if it does not handle it</span></span><br><span class="line">            <span class="comment">// we clear the flag and dispatch the event to all children as usual.</span></span><br><span class="line">            <span class="comment">// We are looking up the accessibility focused host to avoid keeping</span></span><br><span class="line">            <span class="comment">// state since these events are very rare.</span></span><br><span class="line">            View childWithAccessibilityFocus = ev.isTargetAccessibilityFocus()</span><br><span class="line">                    ? findChildWithAccessibilityFocus() : <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN</span><br><span class="line">                    || (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_DOWN)</span><br><span class="line">                    || actionMasked == MotionEvent.ACTION_HOVER_MOVE) &#123;</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> actionIndex = ev.getActionIndex(); <span class="comment">// always 0 for down</span></span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> idBitsToAssign = split ? <span class="number">1</span> &lt;&lt; ev.getPointerId(actionIndex)</span><br><span class="line">                        : TouchTarget.ALL_POINTER_IDS;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Clean up earlier touch targets for this pointer id in case they</span></span><br><span class="line">                <span class="comment">// have become out of sync.</span></span><br><span class="line">                removePointersFromTouchTargets(idBitsToAssign);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> childrenCount = mChildrenCount;</span><br><span class="line">                <span class="keyword">if</span> (newTouchTarget == <span class="keyword">null</span> &amp;&amp; childrenCount != <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">float</span> x = ev.getX(actionIndex);</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">float</span> y = ev.getY(actionIndex);</span><br><span class="line">                    <span class="comment">// Find a child that can receive the event.</span></span><br><span class="line">                    <span class="comment">// Scan children from front to back.</span></span><br><span class="line">                    <span class="keyword">final</span> ArrayList&lt;View&gt; preorderedList = buildTouchDispatchChildList();</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">boolean</span> customOrder = preorderedList == <span class="keyword">null</span></span><br><span class="line">                            &amp;&amp; isChildrenDrawingOrderEnabled();</span><br><span class="line">                    <span class="keyword">final</span> View[] children = mChildren;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = childrenCount - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">                        <span class="keyword">final</span> <span class="keyword">int</span> childIndex = getAndVerifyPreorderedIndex(</span><br><span class="line">                                childrenCount, i, customOrder);</span><br><span class="line">                        <span class="keyword">final</span> View child = getAndVerifyPreorderedView(</span><br><span class="line">                                preorderedList, children, childIndex);</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// If there is a view that has accessibility focus we want it</span></span><br><span class="line">                        <span class="comment">// to get the event first and if not handled we will perform a</span></span><br><span class="line">                        <span class="comment">// normal dispatch. We may do a double iteration but this is</span></span><br><span class="line">                        <span class="comment">// safer given the timeframe.</span></span><br><span class="line">                        <span class="keyword">if</span> (childWithAccessibilityFocus != <span class="keyword">null</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (childWithAccessibilityFocus != child) &#123;</span><br><span class="line">                                <span class="keyword">continue</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            childWithAccessibilityFocus = <span class="keyword">null</span>;</span><br><span class="line">                            i = childrenCount - <span class="number">1</span>;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (!canViewReceivePointerEvents(child)</span><br><span class="line">                                || !isTransformedTouchPointInView(x, y, child, <span class="keyword">null</span>)) &#123;</span><br><span class="line">                            ev.setTargetAccessibilityFocus(<span class="keyword">false</span>);</span><br><span class="line">                            <span class="keyword">continue</span>;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        newTouchTarget = getTouchTarget(child);</span><br><span class="line">                        <span class="keyword">if</span> (newTouchTarget != <span class="keyword">null</span>) &#123;</span><br><span class="line">                            <span class="comment">// Child is already receiving touch within its bounds.</span></span><br><span class="line">                            <span class="comment">// Give it the new pointer in addition to the ones it is handling.</span></span><br><span class="line">                            newTouchTarget.pointerIdBits |= idBitsToAssign;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        resetCancelNextUpFlag(child);</span><br><span class="line">                        <span class="keyword">if</span> (dispatchTransformedTouchEvent(ev, <span class="keyword">false</span>, child, idBitsToAssign)) &#123;</span><br><span class="line">                            <span class="comment">// Child wants to receive touch within its bounds.</span></span><br><span class="line">                            mLastTouchDownTime = ev.getDownTime();</span><br><span class="line">                            <span class="keyword">if</span> (preorderedList != <span class="keyword">null</span>) &#123;</span><br><span class="line">                                <span class="comment">// childIndex points into presorted list, find original index</span></span><br><span class="line">                                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; childrenCount; j++) &#123;</span><br><span class="line">                                    <span class="keyword">if</span> (children[childIndex] == mChildren[j]) &#123;</span><br><span class="line">                                        mLastTouchDownIndex = j;</span><br><span class="line">                                        <span class="keyword">break</span>;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                mLastTouchDownIndex = childIndex;</span><br><span class="line">                            &#125;</span><br><span class="line">                            mLastTouchDownX = ev.getX();</span><br><span class="line">                            mLastTouchDownY = ev.getY();</span><br><span class="line">                            newTouchTarget = addTouchTarget(child, idBitsToAssign);</span><br><span class="line">                            alreadyDispatchedToNewTouchTarget = <span class="keyword">true</span>;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// The accessibility focus didn't handle the event, so clear</span></span><br><span class="line">                        <span class="comment">// the flag and do a normal dispatch to all children.</span></span><br><span class="line">                        ev.setTargetAccessibilityFocus(<span class="keyword">false</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (preorderedList != <span class="keyword">null</span>) preorderedList.clear();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//第二段-----------------------------------------------------------END</span></span><br><span class="line">        <span class="comment">//第三段-----------------------------------------------------------START</span></span><br><span class="line">        <span class="comment">// Dispatch to touch targets.</span></span><br><span class="line">        <span class="keyword">if</span> (mFirstTouchTarget == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// No touch targets so treat this as an ordinary view.</span></span><br><span class="line">            handled = dispatchTransformedTouchEvent(ev, canceled, <span class="keyword">null</span>,</span><br><span class="line">                    TouchTarget.ALL_POINTER_IDS);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Dispatch to touch targets, excluding the new touch target if we already</span></span><br><span class="line">            <span class="comment">// dispatched to it.  Cancel touch targets if necessary.</span></span><br><span class="line">            TouchTarget predecessor = <span class="keyword">null</span>;</span><br><span class="line">            TouchTarget target = mFirstTouchTarget;</span><br><span class="line">            <span class="keyword">while</span> (target != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">final</span> TouchTarget next = target.next;</span><br><span class="line">                <span class="keyword">if</span> (alreadyDispatchedToNewTouchTarget &amp;&amp; target == newTouchTarget) &#123;</span><br><span class="line">                    handled = <span class="keyword">true</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">boolean</span> cancelChild = resetCancelNextUpFlag(target.child)</span><br><span class="line">                            || intercepted;</span><br><span class="line">                    <span class="keyword">if</span> (dispatchTransformedTouchEvent(ev, cancelChild,</span><br><span class="line">                            target.child, target.pointerIdBits)) &#123;</span><br><span class="line">                        handled = <span class="keyword">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    </span><br><span class="line">                &#125;</span><br><span class="line">                predecessor = target;</span><br><span class="line">                target = next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//第三段-----------------------------------------------------------END</span></span><br><span class="line">    <span class="keyword">return</span> handled;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>年轻人，我知道你不想看源码，我也很无奈。</p>
<h3 id="第一段"><a href="#第一段" class="headerlink" title="第一段"></a>第一段</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">    cancelAndClearTouchTargets(ev);</span><br><span class="line">    resetTouchState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">boolean</span> intercepted;</span><br><span class="line"><span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN</span><br><span class="line">        || mFirstTouchTarget != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">boolean</span> disallowIntercept = (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) != <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (!disallowIntercept) &#123;</span><br><span class="line">        intercepted = onInterceptTouchEvent(ev);</span><br><span class="line">        ev.setAction(action); <span class="comment">// restore action in case it was changed</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        intercepted = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// There are no touch targets and this action is not an initial down</span></span><br><span class="line">    <span class="comment">// so this view group continues to intercept touches.</span></span><br><span class="line">    intercepted = <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p></p><p class="text_indent_2">从备注与函数名上理解，开始只是做一些重置初始工作（99.9%情况下，我们要对Google的工程师足够的相信，不然你会越陷越深）。</p>
<p></p><p class="text_indent_2">然后，会在判断里面看到<code>onInterceptTouchEvent(ev)</code>,嗯，终于看到第二个函数了。那么什么情况下会调用这个函数呢？<code>disallowIntercept</code>从字面和后面的赋值理解，这是通过<code>mGroupFlags</code>字段，不允许<code>ViewGroup</code>拦截，通过语句判断如果<code>ACTION_DOWN</code>不予许拦截成立的话(<code>!disallowIntercept == false</code>),所以<code>intercepted = false</code>,（分析时避免情况复杂化，我们要猜一些变量或者函数的意义，比如:!canceled应该就时动作没被取消，正常情况下该条件是成立的）所以，会进入执行第二段。</p>
<h3 id="第二段"><a href="#第二段" class="headerlink" title="第二段"></a>第二段</h3><p></p><p class="text_indent_2">接下来分析一下这个”mChildrenCount”：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Child views of this ViewGroup</span></span><br><span class="line">   <span class="keyword">private</span> View[] mChildren;</span><br><span class="line">   <span class="comment">// Number of valid children in the mChildren array, the rest should be null or not</span></span><br><span class="line">   <span class="comment">// considered as children</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">int</span> mChildrenCount;</span><br></pre></td></tr></table></figure>
<p></p><p class="text_indent_2">现在，大概可以看出什么意思了吧？<code>mChildren</code>是指<code>ViewGroup</code>里面的所有子<code>View</code>,而<code>mChildrenCount</code>指的是能所有有效的<code>ViewGroup</code>里子<code>View</code>的数量，好了，我们接着执行第二段。可以看出，如果没有有效的子<code>View</code>，则会直接进入第三段。如果有有效的子<code>View</code>，且满足传递的要求（这一点可以通过备注看出，各种函数名也表面），则会在该子<code>View</code>执行<code>dispatchTransformedTouchEvent(ev, false, child, idBitsToAssign)</code>，再看看这个函数名:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">dispatchTransformedTouchEvent</span><span class="params">(MotionEvent event, <span class="keyword">boolean</span> cancel,</span></span></span><br><span class="line"><span class="function"><span class="params">           View child, <span class="keyword">int</span> desiredPointerIdBits)</span></span>&#123;</span><br><span class="line">               <span class="comment">//各种判断各种处理以后都会成为这种结构</span></span><br><span class="line">               <span class="keyword">if</span> (child == <span class="keyword">null</span>) &#123;</span><br><span class="line">                       handled = <span class="keyword">super</span>.dispatchTouchEvent(event);</span><br><span class="line">                   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                       handled = child.dispatchTouchEvent(event);</span><br><span class="line">                   &#125;</span><br><span class="line">                   <span class="keyword">return</span> hanled;</span><br><span class="line">           &#125;</span><br></pre></td></tr></table></figure>
<p>啥意思？子<code>View</code>不为空，则子<code>View</code>继续分发事件，否则执行<code>super</code>（赌一包辣条，这里的<code>super</code>就是<code>View</code>）的<code>dispatchTouchEvent</code>,所以接下来看看<code>View</code>的<code>dispatchTouchEvent</code>函数：<br>源码：View#dispatchTouchEvent</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Pass the touch screen motion event down to the target view, or this</span></span><br><span class="line"><span class="comment">     * view if it is the target.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> event The motion event to be dispatched.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> True if the event was handled by the view, false otherwise.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (onFilterTouchEventForSecurity(event)) &#123;</span><br><span class="line">            <span class="comment">//noinspection SimplifiableIfStatement</span></span><br><span class="line">            ListenerInfo li = mListenerInfo;</span><br><span class="line">            <span class="keyword">if</span> (li != <span class="keyword">null</span> &amp;&amp; li.mOnTouchListener != <span class="keyword">null</span></span><br><span class="line">                    &amp;&amp; (mViewFlags &amp; ENABLED_MASK) == ENABLED</span><br><span class="line">                    &amp;&amp; li.mOnTouchListener.onTouch(<span class="keyword">this</span>, event)) &#123;</span><br><span class="line">                result = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!result &amp;&amp; onTouchEvent(event)) &#123;</span><br><span class="line">                result = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!result &amp;&amp; mInputEventConsistencyVerifier != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mInputEventConsistencyVerifier.onUnhandledEvent(event, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Clean up after nested scrolls if this is the end of a gesture;</span></span><br><span class="line">        <span class="comment">// also cancel it if we tried an ACTION_DOWN but we didn't want the rest</span></span><br><span class="line">        <span class="comment">// of the gesture.</span></span><br><span class="line">        <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_UP ||</span><br><span class="line">                actionMasked == MotionEvent.ACTION_CANCEL ||</span><br><span class="line">                (actionMasked == MotionEvent.ACTION_DOWN &amp;&amp; !result)) &#123;</span><br><span class="line">            stopNestedScroll();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p></p><p class="text_indent_2">熟悉不？你有没有<code>OnTouchListener</code>啊，要是有的话，你<code>onTouch</code>返回了啥东东啊？给我看看，我好决定怎么处理<code>onTouchEvent</code>，这里就清楚<code>onTouch</code>和<code>onTouchEvent</code>了吧！！！关于传递—&gt;处理的流程就到这里了。接下来看看返回值对后续的过程影响。</p>
<p></p><p class="text_indent_2">很明显，<code>onTouch</code>与<code>onTouchEvent</code>任意一个返回<code>true</code>(从代码可见得：<code>onTouch</code>返回<code>true</code>后，<code>onTouchEvent</code>是没有机会执行的)，都将成为其所在的<code>ViewGroup</code>的<code>dispatchTransformedTouchEvent(ev, false, child, idBitsToAssign)</code>的返回值，如果返回<code>false</code>则，会使得<code>mFirstTouchTarget == null</code>，直接执行第三段的<code>handled = dispatchTransformedTouchEvent(ev, canceled, null, TouchTarget.ALL_POINTER_IDS);</code>。明显进入<code>[onTouch], onTouchEvent</code>过程<code>handle</code>的返回值将直接依赖这两个（或没有设置<code>onTouch</code>监听就是一个）的返回值，<b>从这里我们知道父<code>ViewGroup</code>中的<code>[onTouch], onTouchEvent</code>也调用了</b>。如果返回<code>true</code>，将会走进<code>addTouchTarget(child, idBitsToAssign)</code>：</p>
<p></p><p class="text_indent_2">源码：ViewGroup#addTouchTarget</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Adds a touch target for specified child to the beginning of the list.</span></span><br><span class="line"><span class="comment">   * Assumes the target child is not already present.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> TouchTarget <span class="title">addTouchTarget</span><span class="params">(View child, <span class="keyword">int</span> pointerIdBits)</span> </span>&#123;</span><br><span class="line">      TouchTarget target = TouchTarget.obtain(child, pointerIdBits);</span><br><span class="line">      target.next = mFirstTouchTarget;</span><br><span class="line">      mFirstTouchTarget = target;</span><br><span class="line">      <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="第三段"><a href="#第三段" class="headerlink" title="第三段"></a>第三段</h3><p></p><p class="text_indent_2"><code>mFirstTouchTarget == null</code>时，上面已经分析。</p>
<p></p><p class="text_indent_2">但是在上述条件不成立的情况下这里<code>mFirstTouchTarget</code>被赋值后，其他非<code>ACTION_DOWN</code>事件将继续通过<code>dispatchTransformedTouchEvent</code>传递到子View，并且。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Dispatch to touch targets, excluding the new touch target if we already</span></span><br><span class="line"><span class="comment">// dispatched to it.  Cancel touch targets if necessary.</span></span><br><span class="line">TouchTarget predecessor = <span class="keyword">null</span>;</span><br><span class="line">TouchTarget target = mFirstTouchTarget;</span><br><span class="line"><span class="keyword">while</span> (target != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">final</span> TouchTarget next = target.next;</span><br><span class="line">    <span class="keyword">if</span> (alreadyDispatchedToNewTouchTarget &amp;&amp; target == newTouchTarget) &#123;</span><br><span class="line">        handled = <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> cancelChild = resetCancelNextUpFlag(target.child)</span><br><span class="line">                || intercepted;</span><br><span class="line">        <span class="keyword">if</span> (dispatchTransformedTouchEvent(ev, cancelChild,</span><br><span class="line">                target.child, target.pointerIdBits)) &#123;</span><br><span class="line">            handled = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    predecessor = target;</span><br><span class="line">    target = next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p></p><p class="text_indent_2">大致流程就是这样分析的，未完待续。。。。。。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p></p><p class="text_indent_2">这篇文章是看完《Android开发艺术探索》后自己跟着源码一步步来走的，看完书以后其实只是一个轮廓，然后自己看源码后映像深刻了些，但总是感觉不放心，编程路上一位导师曾经跟我说过：当你觉得你懂了得时候，你就该写下来。当你觉得你能写明白得时候，去找一个人然后把他教会。这时候你才是真正得懂。</p>
<p></p><p class="text_indent_2">遗憾由于水平有限，连写都没能写得明白，但是写得过程中确实也有了不少得收获，但也不该只满足于此。</p>
<p></p><p class="text_indent_2">有人说对于源码得追究其实不该太过钻牛角，然而还是希望尽量满足自己得好奇心，待续。。。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/29/Hexo-theme-next日常操作/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Joe Wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/joe.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Joetube">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/29/Hexo-theme-next日常操作/" itemprop="url">Hexo-theme-next日常操作</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-29T11:57:30+08:00">
                2018-01-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="图片不知道放哪？"><a href="#图片不知道放哪？" class="headerlink" title="图片不知道放哪？"></a>图片不知道放哪？</h2><p>&emsp;&emsp;主题自带一个文件目录( <code>项目名/public/images</code> )，但为了导致手欠造成破坏，所以在<code>public</code>目录下新建<code>pic</code>文件夹，然后在&lt;image/&gt;使用<code>src=&quot;/pic/xxxx.jpg&quot;</code>（由文章的URL可以知道<code>pulic</code>这货才是站点根目录）。</p>
<h2 id="自定义样式？"><a href="#自定义样式？" class="headerlink" title="自定义样式？"></a>自定义样式？</h2><p>&emsp;&emsp;主题内容的样式太单一？想使用主题内部样式又没有文档？每次缩进还要 &amp;emsp;？</p>
<p>&emsp;&emsp;太苦了！强迫症、懒人基因、程序思维、职业修养。。。不能自定义的都是耍流氓。</p>
<p>&emsp;&emsp;打开主题目录(<code>themems/hexo-theme-next</code>)，进入<code>css</code>目录，再看看<code>main.styl</code>末尾~，我靠！竟然是custom~ custom~ custom~ ，别告诉我你一点想法也没有，再进入<code>@import &quot;_custom/custom&quot;;</code>所指向的文件&gt;&gt;&gt;&gt;空的&lt;&lt;&lt;&lt;，没错这就是留给你自定义样式的。</p>
<p>&emsp;&emsp;别急，还有！！！怎么自定义它解析的MarkDown标签？<br>&emsp;&emsp;打开你的丑到不能直视的网页（你用MarkDown写的那种，别打开首页，然后告诉我都是泡沫！！），按下<code>F12</code>，偷偷喵喵一眼你写的标签被加了那些<code>class</code>，再<code>custom.styl</code>中重写样式即可。还记得<code>_custom\custom</code>是最后<code>import</code>的么？哪如果没意外的话<code>_custom\custom</code>中自定义的样式就会覆盖主题原来的样式。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/29/VelocityTracker、GestureDetector和Scroller实践/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Joe Wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/joe.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Joetube">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/29/VelocityTracker、GestureDetector和Scroller实践/" itemprop="url">VelocityTracker和Scroller实践</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-29T11:48:06+08:00">
                2018-01-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="VelocityTracker"><a href="#VelocityTracker" class="headerlink" title="VelocityTracker"></a>VelocityTracker</h1><h2 id="使用注意事项"><a href="#使用注意事项" class="headerlink" title="使用注意事项"></a>使用注意事项</h2><p></p><p class="text_indent_2"> <code>VelocityTracker</code> 资源在使用完毕后需要释放，通常在 <code>MotionEvent.ACTION_CANCEL</code> &amp;&amp; <code>MotionEvent.ACTION_UP</code> 后释放，释放调用如下方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">velocityTracker.clear();</span><br><span class="line">velocityTracker.recycle();</span><br></pre></td></tr></table></figure>
<p></p><p class="text_indent_2">但是需要注意的是，掉用后会发生异常（回收任务已在线程池中），所以需要在调用前加<code>!= null</code>判断，在调用后将<code>velocityTracker</code>置空，因为每次使用后都会置空回收，因此在每次启用时都要初始化，而不是只初始化一次（例如：放在<code>onCreate</code>中进行初始化）。</p>
<p></p><p class="text_indent_2">还有如果要追踪<code>MotionEvent.ACTION_MOVE</code>，则需要在每次<code>MotionEvent.ACTION_DOWN</code> 和 <code>MotionEvent.ACTION_MOVE</code>时调用<code>addMovement(event)</code>。</p>
<p></p><p class="text_indent_2">具体代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(tracker == <span class="keyword">null</span>)&#123;</span><br><span class="line">        tracker = VelocityTracker.obtain();</span><br><span class="line">    &#125;</span><br><span class="line">    tracker.addMovement(event);</span><br><span class="line">    <span class="keyword">switch</span> (event.getAction())&#123;</span><br><span class="line">       <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">           mPointId = event.getPointerId(<span class="number">0</span>);</span><br><span class="line">           <span class="keyword">break</span>;</span><br><span class="line">       <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">           tracker.computeCurrentVelocity(<span class="number">1000</span>, ViewConfiguration.get(<span class="keyword">this</span>).getScaledMaximumFlingVelocity());</span><br><span class="line">           <span class="keyword">final</span> <span class="keyword">float</span> xVelocity = tracker.getXVelocity(mPointId);</span><br><span class="line">           <span class="keyword">final</span> <span class="keyword">float</span> yVelocity = tracker.getYVelocity(mPointId);</span><br><span class="line">           Log.i(TAG, String.format(<span class="string">"xVelocity = %f, yVelocity = %f"</span>, xVelocity, yVelocity));</span><br><span class="line">           <span class="keyword">break</span>;</span><br><span class="line">       <span class="keyword">case</span> MotionEvent.ACTION_CANCEL:</span><br><span class="line">       <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">           <span class="keyword">if</span>(tracker != <span class="keyword">null</span>)&#123;</span><br><span class="line">               tracker.clear();</span><br><span class="line">               tracker.recycle();</span><br><span class="line">               tracker = <span class="keyword">null</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">break</span>;</span><br><span class="line">       <span class="keyword">default</span>:</span><br><span class="line">           <span class="keyword">break</span>;</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.onTouchEvent(event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Scroller"><a href="#Scroller" class="headerlink" title="Scroller"></a>Scroller</h1><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p></p><p class="text_indent_2"><code>Scroller</code>所做的事情只是将<b><code>View</code>中的内容移动位置</b>移动，而非<code>View</code>本身，如果需要移动<code>View</code>则应该考虑在其所在的<code>ViewGroup</code>中使用<code>Scroller</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">scroller = <span class="keyword">new</span> Scroller(context);</span><br><span class="line">....</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">smoothScrollTo</span><span class="params">(<span class="keyword">int</span> destX, <span class="keyword">int</span> destY)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> scrollX = getScrollX();<span class="comment">//先推导一个方向，再同理推导</span></span><br><span class="line">        <span class="keyword">int</span> scrollY = getScrollY();</span><br><span class="line">        <span class="keyword">int</span> deltaX = destX + scrollX;</span><br><span class="line">        <span class="keyword">int</span> deltaY = destY + scrollY;</span><br><span class="line">        scroller.startScroll(scrollX, scrollY, -deltaX, -deltaY, <span class="number">1000</span>);</span><br><span class="line">       <span class="comment">// Log.i(TAG, String.format("scrollX = %d, scrollY = %d, deltaX = %d, deltaY = %d", scrollX, scrollY, deltaX, deltaY));</span></span><br><span class="line">        invalidate();</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">computeScroll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(scroller.computeScrollOffset())&#123;</span><br><span class="line">            scrollTo(scroller.getCurrX(), scroller.getCurrY());</span><br><span class="line">            invalidate();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p></p><p class="text_indent_2">注意事项，在<code>View.invalidate()</code>中又注释到：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Invalidate the whole view. If the view is visible,</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> #onDraw(android.graphics.Canvas)&#125; will be called at some point in</span></span><br><span class="line"><span class="comment"> * the future.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * This must be called from a UI thread. To call from a non-UI thread, call</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> #postInvalidate()&#125;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invalidate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    invalidate(<span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p></p><p class="text_indent_2">而<code>onDraw(Canvas canvas)</code>只在<code>draw(Canvas canvas)</code>里有调用，所以实际上<code>draw(Canvas canvas)</code>,而<code>draw(Canvas canvas)</code>会调用<code>computeScroll()</code>方法，所以就会一直<code>scrollTo(scroller.getCurrX(), scroller.getCurrY());</code>，直到条件返回为<code>false</code>。</p>
<p></p><p class="text_indent_2">至于<code>deltaX</code>与<code>deltaY</code>的计算，建议先从单个坐标（另外一个置零最好）分析。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/29/AndroidStudio日常较量/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Joe Wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/joe.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Joetube">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/29/AndroidStudio日常较量/" itemprop="url">AndroidStudio日常较量</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-29T09:46:54+08:00">
                2018-01-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="问题：the-sdk-plat-form-tools-revision-25-0-3-is-too-old-to-check-APIs"><a href="#问题：the-sdk-plat-form-tools-revision-25-0-3-is-too-old-to-check-APIs" class="headerlink" title="问题：the sdk plat-form tools revision (25.0.3) is too old to check APIs"></a>问题：the sdk plat-form tools revision (25.0.3) is too old to check APIs</h3><p>&emsp;&emsp; 分析：compile ‘com.android.support:appcompat-v7:26.+’引入了高版本包，而本地的Android SDK Platform-Tools</p>
<p>&emsp;&emsp; 解决1：分别降低目标SDK版本<code>targetSdkVersion</code> 和编译版本<code>compileSdkVersion</code>，最好能保持<code>compileSdkVersion</code>和<code>targetSdkVersion</code>一致，降低引入包的版本为：compile ‘com.android.support:appcompat-v7:25.+’(25为我选择的Version)</p>
<p>&emsp;&emsp;解决2（推荐）：SDK Manager-&gt;SDK Tools-&gt;Android SDK Platform-Tools 勾选更新，重启Android Studio</p>
<h3 id="问题：在Debug模式下，Android-Studio生成的debug证书与第三方所提交的证书不一致，导致第三方调用失败"><a href="#问题：在Debug模式下，Android-Studio生成的debug证书与第三方所提交的证书不一致，导致第三方调用失败" class="headerlink" title="问题：在Debug模式下，Android Studio生成的debug证书与第三方所提交的证书不一致，导致第三方调用失败"></a>问题：在Debug模式下，Android Studio生成的debug证书与第三方所提交的证书不一致，导致第三方调用失败</h3><p></p><p class="text_indent_2">解决：在<code>gradle</code>中添加<code>debug</code>配置（顺便吐槽一句），清空缓存重新编译。点击<code>Android Studio</code>右下角的<code>Event Log</code>即可看到Gradle任务执行日志。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/28/加载器建立过程中的一些问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Joe Wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/joe.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Joetube">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/28/加载器建立过程中的一些问题/" itemprop="url">加载器建立过程中的一些问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-28T15:56:49+08:00">
                2018-01-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="调试记录"><a href="#调试记录" class="headerlink" title="调试记录"></a>调试记录</h2><p>&emsp;&emsp;Bitmap网络加载时，若对图片先使用<code>BitmapFactory.decodeStream</code>非全部加载测量，<strong><em>则会导致InputStream起始位置移动，影响下一步的对流的解码</em></strong>，因此解码前需要重置，但是重置的最大限度需要控制（多了会浪费，少了会崩溃），所以网上有采用<code>decodeByteArray</code>解码比特数组，而比特数组内容由<code>ByteArrayOutputStream</code>而得(<code>toByteArray</code>调用的就是<code>Array.copy(byte[], int length)</code>, <code>ByteArrayOutputStream</code>实质维护一个大小可扩的<code>byte[]</code>)，虽然避免维护<code>readlimit</code>，但是运行时暂时会占用两个图片内存，庆幸的是这两个内存只是局部变量能GC掉。而《Android开发艺术探索》则是直接直接采用<code>BitmapFactory.decodeStream(InputStream)</code>，没有测量的直接全部加载。<a href="https://www.jianshu.com/p/634fc6feb47b" target="_blank" rel="noopener">关于BitmapFactory.decode</a><br>&emsp;&emsp;&emsp;&emsp;关于加载网络图片前是否测量，本人看法如下：<br>&emsp;&emsp;&emsp;&emsp;测量的目的是为了避免内存消耗过大导致OOM，本地图片的话，可以通过文件描述符获取大小后，再进行有必要的内存分配。而采用<code>ByteArrayOutputStream</code>硬生生是多了两个byte[]，而且大小等于原始资源图片大小，如果有OMM的话，这个方案恐怕会首当其冲，但是在测试中还没发现OMM。所以选择直接采用<code>BitmapFactory.decodeStream(InputStream)</code>，简单有效，这只是个人的猜测，具体问题我已经在<a href="https://stackoverflow.com/questions/48492934/is-it-necessary-to-measure-the-image-before-decode-a-connection-inputstream" target="_blank" rel="noopener">Stackoveflow</a>中提出，望各位不吝赐教。<br>&emsp;&emsp;&emsp;&emsp;关于Buffer缓冲：</p>
<p>&emsp;&emsp;&emsp;&emsp;不带缓冲是，每读一个字节就要写一个字节，对磁盘IO操作频繁效率低；带缓冲，一次多个字节，先写进内存然后等填满后，批量写入磁盘提高效率。</p>
<p>&emsp;&emsp;&emsp;&emsp;<a href="http://blog.csdn.net/fzhmoive/article/details/21862425" target="_blank" rel="noopener">InputStream 、 InputStreamReader 、 BufferedReader餐补</a>，</p>
<p>&emsp;&emsp;温故而知新，加强理解。</p>
<p>&emsp;&emsp;缓冲输入流(<code>BufferedInputStream</code>)本质上是通过缓冲区中的数组实现的。在新建输入流对应的<code>BufferedInputStream</code>后，当缓冲区数据被读取完毕后，<code>BufferInputStream</code>会将该输入流的数据分批地填入到缓冲区中。缓冲区数据读取完毕后自行填充后继数据。</p>
<p>&emsp;&emsp;&emsp;&emsp;错位？而<code>BitmapFactory.decodeStream(InputStream is, Rect outPadding, Options opts)</code>对<code>InputStream</code>进行读取将会使得流的起始位置发生向后移动，因此如果解码前先<code>decodeStream</code>测量，<code>Buffer</code>需要<code>reset()</code>重新设置读取<code>InputStream</code>的起始位置，并且需要在<code>mark(int readlimit)</code>进行控制。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/27/单例模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Joe Wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/joe.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Joetube">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/27/单例模式/" itemprop="url">单例模式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-27T20:35:21+08:00">
                2018-01-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>&emsp;&emsp;最近的文章均围绕自定义的简易图片加载工具类–ImageLoad，进行学习和分析，源码暂时扣押(还没完全写完。又要搭环境、又要写文章、还要敲代码，还不给钱~~~要代码？ &emsp;&emsp;做梦去吧!)。</p>
<p>&emsp;&emsp; 别别别！ 我开玩笑的，明天就给明天就给。</p>
<p>&emsp;&emsp;源码送上，请各位帮帮Check Check。<a href="https://github.com/jiarWang/AndroidView/tree/master/Demo" target="_blank" rel="noopener">XXX0</a></p>
<p><img src="/pic/00005.jpg"></p>
<p>&emsp;&emsp;基于图片加载工具(ImageLoader)的特点：开辟线程池、创建维护图片缓存与磁盘缓存等，决定了它非单例不可。</p>
<h2 id="推荐"><a href="#推荐" class="headerlink" title="推荐"></a>推荐</h2><p>&emsp;&emsp;推荐文章–<a href="http://www.runoob.com/design-pattern/singleton-pattern.html" target="_blank" rel="noopener">单例模式|菜鸟教程</a>。不过你可能需要对synchronized进行了解，说到synchronized怎么能忘记volatile呢？</p>
<h3 id="关于synchronized"><a href="#关于synchronized" class="headerlink" title="关于synchronized"></a>关于synchronized</h3><p>&emsp;&emsp;以后可能会写一篇，暂时推荐<a href="https://stackoverflow.com/questions/14495776/synchronizethis-vs-synchronizemyclass-class" target="_blank" rel="noopener">stackoverflow</a>和<a href="https://juejin.im/post/594a24defe88c2006aa01f1c#heading-10" target="_blank" rel="noopener">Java 之 synchronized 详解</a>。<br>&emsp;&emsp;synchronized锁对象(this，非静态方法)或类(.class，静态方法)，且记住static修饰的方法不属于任何对象而是与class处于同地位，所以同一个类中的synchronized静态方法与synchronized非静态方法可以异步执行。</p>
<h3 id="关于volatile"><a href="#关于volatile" class="headerlink" title="关于volatile"></a>关于volatile</h3><p>&emsp;&emsp;写作计划待定，暂推荐<a href="https://www.cnblogs.com/dolphin0520/p/3920373.html" target="_blank" rel="noopener">volatile</a>，还有一篇大神的<a href="http://www.infoq.com/cn/articles/ftf-java-volatile" target="_blank" rel="noopener">深入分析Volatile的实现原理</a>，暂时还不敢恭维。</p>
<h2 id="总结与比较"><a href="#总结与比较" class="headerlink" title="总结与比较"></a>总结与比较</h2><p>&emsp;&emsp;饿汉式：在类装载的时候实例化，如果对象没有被用到那么实例对象所占的空间就是被浪费掉的。</p>
<p>&emsp;&emsp;懒汉式：在需要使用时且发现没有实例对象时才实例化，即第一次使用时实例化，以后均使用这同一个对象。</p>
<p>&emsp;&emsp;最后非常要注意的就是线程安全，以及通过synchronized加锁位置的不同在性能上为何会起到优化作用？</p>
<p><img src="/pic/00006.jpg"></p>
<p>&emsp;&emsp;<a href="http://www.runoob.com/design-pattern/singleton-pattern.html" target="_blank" rel="noopener">单例模式</a>此篇中，比较第2种Lazy（第2种方式暂标记为Lazy，实则DCL也是懒汉式）创建方式和第4种DCL方式，可以看出Lazy使用synchronized为static方法加上锁，故而当多个线程同时调用此方法时，都会进入同步等待状态。而DCL式则是在判断后再进入，当对象已存在后，多个线程调用此方法时将不会陷入同步排队等待之中。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/27/掘金好文章-Android/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Joe Wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/joe.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Joetube">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/27/掘金好文章-Android/" itemprop="url">掘金文章(Android)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-27T19:47:44+08:00">
                2018-01-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>&emsp;&emsp;闲暇时间在帮助掘金社区挖掘优秀文章，挖掘的过程也是自我提高的过程。此片专注收录一些个人认为值得Mark的优秀文章(各平台均有)。</p>
<h2 id="2018-01"><a href="#2018-01" class="headerlink" title="2018/01"></a>2018/01</h2><ul>
<li><a href="https://juejin.im/post/5a652d31518825734108080d?from=timeline" target="_blank" rel="noopener">Android性能优化</a></li>
<li><a href="https://www.jianshu.com/p/ed9e15eff47a" target="_blank" rel="noopener">handler内存泄漏原因</a></li>
<li><a href="https://juejin.im/post/5a615c796fb9a01caf377b20" target="_blank" rel="noopener">浅谈Android的文件存储</a></li>
<li><a href="https://juejin.im/post/5a696dae51882573541c8fe8" target="_blank" rel="noopener">Android动画小结</a></li>
<li><a href="https://juejin.im/post/5a69857a6fb9a01c952647e1" target="_blank" rel="noopener">UML刨析–类图关联和时序图</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/27/站点介绍/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Joe Wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/joe.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Joetube">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/27/站点介绍/" itemprop="url">站点介绍</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-27T16:10:29+08:00">
                2018-01-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="2018-01-27"><a href="#2018-01-27" class="headerlink" title="2018-01-27"></a>2018-01-27</h2><p>连续下雪，简直不要太美了。不想错误如此美景，所以决定在窗旁键盘前，摆好姿势，好好装个B，尼玛！冷得一匹。</p><p><br><img src="/pic/00002.jpg"><br></p><p>先预热一哈。。。。。。。。好了，开始闲聊~</p><br><img src="/pic/00001.jpg"><br><p>下午何时忘记了，终于撸完了简易的图片加载工具类(内存缓存、磁盘缓存、网络加载分阶段开发及讲述)，对没错Demo级别的，再看看自己半年前撸的那个，感觉硬生生是搬运出来的，又想起老师告诫：视频无用（有些时候视频还是能有启蒙作用，就这个问题我们还互怼过），感慨万千，后不自觉在github上关注到了一位学弟（别误会），吃了一惊，WKF！后生可畏~，长江后浪推前浪啊！</p><br><img src="/pic/00003.jpg"><br><p>然后在学弟的启发下（虽然内容有限，但是整理地很得当，为我省去了很多时间），建立了这一个站点， 站点的内容也主要是记录学习历程，历程就以这个工具类开始。</p><br><p>两年半前第一次对博客有个概念，两年前第一次用服务器搭建自己的wordpress，然后由于太过单纯，数据库既然被人留下了QQ号。后来又买了域名准备重新开始，并且做好备份。谁知。。。。，最终备案不通，线程阻塞，不了了之，只得将笔记写再OneNote上，也在其他的平台上画过一些把戏。</p><br><img src="/pic/00004.jpg"><br><br><br>## 2018-01-29<br><br>&emsp;&emsp;前几日在讨论交流的时候，看到一篇文章，具体内容是：一个“样样学会”的10年老码农，面临失业（市场能给的价格和自己期望的相差太远）。我对这篇文章的印象不是很深，但是讨论的时候一句话戳中了我。“有的人是10年经验，而有的人是10 x 1年”，再想想周围的人和事（当然，每个人的追求不同，所以我这里无任何批评之意），又何尝不是这样，十年经验不知进取，有问题不探索，知其然不知所以然。同一个问题遇到一遍搜索一遍，拷贝一遍，重复几次十几次几十次，看则十年经验，实则不到1-2年。游戏、新闻、短视频、武侠小说等等，十年浮躁。<br>&emsp;&emsp;正如胡适的“你的空闲时间，决定了你的人生高度”，我并非批评这些娱乐方式，只是娱乐需要有限度，时间不应该被浪费，“有的人25岁就死了 只是到75岁才埋葬 我们究竟是活了365天 还是活了1天 重复了364遍 ​​​​”。<br><br>&emsp;&emsp;献给明天的自己<br><br>## 2018-01-30<br><br><p class="text_indent_2">今天在啃《Android开发艺术探索》，妈耶！关于有些知识，我还以为我一直的想法是对的，结果特么原来的固有思维导致我在阅读的时候越读越难懂，后来摒弃已有的知识重新整理，感觉自己已是漏洞百出。还有现在感觉看源码的正确知识应该是：关键函数、函数及变量命名、注释，而是不是一味地函数跟踪（大佬可能有更多的建议，等我慢慢积累了再添加吧）。<br><br>## 2018-01-31<br></p><p class="text_indent_2">今天心情有点不太好，跑了1.5KM。然后心情就好了。。。<br><br>## 2018-02-10<br></p><p class="text_indent_2">和盼姐聊了一席话，感觉需要努力的地方实在时太多。故而计划在过年的这几天每天花3小时和盼姐学习英语。<br><br>## 2018-02-11<br><br></p><p class="text_indent_2">My dreaming-girl lied me that she would get married, I want to ignore it for not being hurted, but I don’t think I owe somebody nothing, so I replied this girl without take care of her purpose.<br><br></p><p class="text_indent_2">My sister pan told me that I had msut hurted someone deeply, and I am a bed gay, but the distance between us makes loving becoming fade. Sister pan asked me if there any prossible for me to decide to give my hands to this girl, I replied that if she come to ShangHai, I would, no ~ , I must give her my hands. I alse asked myself why i  can’t go to her city .<br></p><p class="text_indent_2">Doing something for not being regret.<br><br>## 2018-03-01<br><br>春节，一直在和盼姐练习口语，虽然只有10来天，但是还是觉得受益匪浅。毕竟能做到跟人说英语不脸红了（虽然很蹩脚）。<br><br>2月份在家里的阅读量有所下降，可能是由于春节的原因，但基本还是做到了一月至少一本非专业书籍。为了毕设也看了一点Tensorflow，只是皮毛中的皮毛。至于android貌似近乎停滞，心中有愧。<br><br>在这一个半年里敲过了《第一行代码》、看完了《群英传》，然而关于《Android开发艺术探索》的咀嚼近日陷入了迷茫，看得似懂非懂，感觉实际的时候用到得并不多，看完了也不太熟，有些怀疑自己“假大空”，有问题还是要搜索，所以不敢再往下看了。幸得前辈指导，是自己性子没沉下来，眼高手低又急于求切了，所以现在要做得就是把这本书先嚼完，然后对照《群英传》与网络上得素材反复实践练习，对照《开发艺术探索》理解，循序渐进，做到“知其然，知其所以然”。<br><br>所以关于《Android 源码设计模式解析与实战》暂时搁置。<br><br>3月份目前的安排是完成毕设初稿，先稳定好整体节奏，然后将二月份遗留得《白说》阅读完毕，购买《偶遇》并在不影响论文进度得条件下，尽量阅读完毕（每天抽），关于Android得练习，暂时将上午得闲暇时间联系并阅读Android Training。<br><br>微笑着待人，微笑着生活<br><br></p><p>未完待续…</p>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/joe.jpg"
                alt="Joe Wang" />
            
              <p class="site-author-name" itemprop="name">Joe Wang</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Joe Wang</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
